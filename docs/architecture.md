# Gemini CLI 架構總覽

本文檔提供 Gemini CLI 架構的高層次總覽。

## 核心組件

Gemini CLI 主要由兩個核心套件組成，並搭配一組可由系統在處理命令列輸入過程中使用的工具：

1.  **CLI 套件 (`packages/cli`)：**
    - **用途：** 此套件包含 Gemini CLI 的使用者端部分，例如處理初始使用者輸入、呈現最終輸出，以及管理整體使用者體驗。
    - **套件內包含的主要功能：**
      - [輸入處理](./cli/commands.md)
      - 歷史紀錄管理
      - 顯示渲染
      - [主題與 UI 客製化](./cli/themes.md)
      - [CLI 設定選項](./cli/configuration.md)

2.  **Core 套件 (`packages/core`)：**
    - **用途：** 此套件作為 Gemini CLI 的後端。它接收來自 `packages/cli` 的請求，協調與 Gemini API 的互動，並管理可用工具的執行。
    - **套件內包含的主要功能：**
      - 與 Google Gemini API 通訊的 API client
      - 提示詞（prompt）建構與管理
      - 工具註冊與執行邏輯
      - 對話或工作階段的狀態管理
      - 伺服器端設定

3.  **工具 (`packages/core/src/tools/`)：**
    - **用途：** 這些是獨立模組，可擴充 Gemini 模型的能力，使其能與本地環境互動（例如：檔案系統、shell 指令、網頁抓取）。
    - **互動方式：** `packages/core` 會根據 Gemini 模型的請求呼叫這些工具。

## 互動流程

典型的 Gemini CLI 互動流程如下：

1.  **使用者輸入：** 使用者在終端機中輸入提示詞或指令，這由 `packages/cli` 管理。
2.  **傳送請求至 Core：** `packages/cli` 將使用者的輸入傳送給 `packages/core`。
3.  **請求處理：** Core 套件會：
    - 為 Gemini API 建構合適的提示詞（prompt），可能包含對話歷史與可用工具定義。
    - 將提示詞發送給 Gemini API。
4.  **Gemini API 回應：** Gemini API 處理提示詞並回傳回應。此回應可能是直接答案，也可能是請求使用某個可用工具。
5.  **工具執行（如適用）：**
    - 當 Gemini API 請求某個工具時，Core 套件會準備執行該工具。
    - 若請求的工具會修改檔案系統或執行 shell 指令，系統會先向使用者說明該工具及其參數，並要求使用者同意後才執行。
    - 僅讀取操作（如讀取檔案）則可能不需使用者明確同意即可執行。
    - 一旦獲得同意（或不需同意），Core 套件會在相關工具內執行對應動作，並將結果回傳給 Gemini API。
    - Gemini API 處理工具結果後，產生最終回應。
6.  **回應傳送至 CLI：** Core 套件將最終回應傳送回 CLI 套件。
7.  **顯示給使用者：** CLI 套件將回應格式化並在終端機中顯示給使用者。

## 主要設計原則

- **模組化：** 將 CLI（前端）與 Core（後端）分離，可獨立開發並支援未來擴充（例如：同一後端可搭配不同前端）。
- **可擴充性：** 工具系統設計為可擴充，方便新增新功能。
- **使用者體驗：** CLI 著重於提供豐富且互動的終端機體驗。
