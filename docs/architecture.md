# 架構總覽

本文件提供 Gemini CLI 架構的高階總覽。

## 核心元件

Gemini CLI 主要由兩個主要套件組成，以及一套在處理命令列輸入過程中可供系統使用的工具：

1.  **CLI 套件 (`packages/cli`)**：
    - **目的**：包含 Gemini CLI 面向使用者的部分，例如處理初始使用者輸入、呈現最終輸出，以及管理整體使用者體驗。
    - **套件包含的主要功能**：
      - [輸入處理](./cli/commands.md)
      - 歷史記錄管理
      - 顯示渲染
      - [主題和 UI 自訂](./cli/themes.md)
      - [CLI 設定](./cli/configuration.md)

2.  **核心套件 (`packages/core`)**：
    - **目的**：作為 Gemini CLI 的後端。它接收來自 `packages/cli` 的請求，協調與 Gemini API 的互動，並管理可用工具的執行。
    - **套件包含的主要功能**：
      - 與 Google Gemini API 通訊的 API 用戶端
      - 提示建構和管理
      - 工具註冊和執行邏輯
      - 對話或工作階段的狀態管理
      - 伺服器端設定

3.  **工具 (`packages/core/src/tools/`)**：
    - **目的**：這些是擴充 Gemini 模型功能的個別模組，讓它能與本機環境互動（例如，檔案系統、Shell 指令、網頁擷取）。
    - **互動**：`packages/core` 根據來自 Gemini 模型的請求調用這些工具。

## 互動流程

典型的 Gemini CLI 互動遵循此流程：

1.  **使用者輸入：** 使用者在終端中輸入提示或指令，這由 `packages/cli` 管理。
2.  **向核心發送請求：** `packages/cli` 將使用者的輸入傳送到 `packages/core`。
3.  **請求處理：** 核心套件：
    - 為 Gemini API 建構適當的提示，可能包括對話歷史記錄和可用的工具定義。
    - 將提示傳送到 Gemini API。
4.  **Gemini API 回應：** Gemini API 處理提示並回傳回應。此回應可能是直接答案或使用其中一個可用工具的請求。
5.  **工具執行（如果適用）：**
    - 當 Gemini API 請求工具時，核心套件準備執行它。
    - 如果請求的工具可以修改檔案系統或執行 shell 指令，會首先向使用者提供工具及其引數的詳細資料，使用者必須批准執行。
    - 唯讀操作，例如讀取檔案，可能不需要明確的使用者確認即可繼續。
    - 一旦確認，或如果不需要確認，核心套件會在相關工具內執行相關操作，結果會由核心套件傳送回 Gemini API。
    - Gemini API 處理工具結果並產生最終回應。
6.  **回應至 CLI：** 核心套件將最終回應傳送回 CLI 套件。
7.  **顯示給使用者：** CLI 套件在終端中格式化並顯示回應給使用者。

## 關鍵設計原則

- **模組化：** 將 CLI（前端）與核心（後端）分離，允許獨立開發和潛在的未來擴展（例如，同一後端的不同前端）。
- **可擴展性：** 工具系統設計為可擴展的，允許新增新功能。
- **使用者體驗：** CLI 專注於提供豐富且互動式的終端體驗。
